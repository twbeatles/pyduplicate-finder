from PySide6.QtCore import QLocale

class I18n:
    _instance = None
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super(I18n, cls).__new__(cls)
            cls._instance.current_lang = "ko" # Default
            cls._instance.translations = {
                "en": {
                    "app_title": "PyDuplicate Finder Pro",
                    "scan_start": "Start Scan",
                    "scan_stop": "Stop",
                    "status_ready": "Ready",
                    "menu_file": "File",
                    "menu_help": "Help",
                    "menu_lang": "Language",
                    "btn_add_folder": "Add Folder",
                    "btn_add_drive": "Add Drive",
                    "btn_clear": "Clear",
                    "lbl_no_selection": "No location selected",
                    "grp_search_loc": "1. Search Location",
                    "grp_search_opt": "2. Search Options",
                    "lbl_ext": "Extensions (e.g., jpg, pdf):",
                    "ph_ext": "Leave empty for all",
                    "lbl_min_size": "Min File Size (KB):",
                    "chk_same_name": "Match file names too",
                    "chk_byte_compare": "Byte-by-byte compare (100% accurate, slower)",
                    "chk_protect_system": "Protect System Folders (Exclude Windows/Program Files)",
                    "btn_start_scan": "Start Scan",
                    "col_path": "File Path / Group",
                    "col_size": "Size",
                    "col_mtime": "Modified Date",
                    "col_ext": "Ext",
                    "lbl_preview": "Preview",
                    "msg_select_file": "Select a file to preview",
                    "btn_smart_select": "Auto Select (Smart)",
                    "tip_smart_select": "Keeps the oldest file in each group.",
                    "btn_export": "Export Results (CSV)",
                    "btn_delete_selected": "Delete Selected (Undoable)",
                    "msg_no_files_selected": "No files selected.",
                    "confirm_delete_title": "Confirm Delete",
                    "confirm_delete_msg": "Delete {} files (Move to Trash)?\nYou can Undo this.",
                    "msg_delete_success": "{} files deleted. (Ctrl+Z to Undo)",
                    "msg_undo_complete": "Undo Complete.",
                    "msg_redo_complete": "Redo Complete: {} deleted again.",
                    "msg_scan_complete": "Done: {} duplicate groups found",
                    "err_no_folder": "Please add a folder or drive to scan.",
                    "err_save": "Error saving:\n{}",
                    "ctx_open": "Open",
                    "ctx_open_folder": "Open Folder",
                    "ctx_copy_path": "Copy Path",
                    "file_open_dialog": "Select Folder",
                    "status_collecting_files": "Collecting files...",
                    "status_hashing": "Hashing...",
                    "status_hashing_progress": "Hashing ({}/{})",
                    "status_analyzing": "Analyzing candidates",
                    "status_undoing": "Undoing...",
                    "status_redoing": "Redoing...",
                    "status_byte_compare": "Byte comparing...",
                    "status_comparing": "Comparing...",
                    "status_done": "Done",
                    "status_stopped": "Stopped",
                    "dlg_empty_title": "Empty Folder Finder",
                    "lbl_search_target": "Target: {} locations",
                    "btn_scan_empty": "Find Empty Folders",
                    "btn_delete_all": "Delete All",
                    "status_searching": "Searching...",
                    "status_search_done": "Done: {} found",
                    "confirm_empty_delete": "Delete {} empty folders?\nCannot be undone!",
                    "msg_empty_delete_result": "Deleted: {}.\nFailed: {}.",
                    "msg_n_folders_added": "{} folders added.",
                    "action_undo": "Undo",
                    "action_redo": "Redo",
                    "action_empty_finder": "Find Empty Folders",
                    "action_theme": "Dark Mode",
                    "msg_title_notice": "Notice",
                    "msg_add_folder_first": "Please add a search location first.",
                    "msg_delete_files_title": "Delete Files",
                    "msg_delete_files_confirm": "Delete {} files? (Move to Trash)",
                    "err_open_file": "Could not open file.",
                    "term_duplicate_group": "Duplicate Group",
                    "term_files": "files",
                    "err_unexpected": "An unexpected error occurred:\n{}",
                    "lang_ko": "Korean",
                    "lang_en": "English"
                },
                "ko": {
                    "app_title": "PyDuplicate Finder Pro",
                    "scan_start": "스캔 시작",
                    "scan_stop": "중지",
                    "status_ready": "준비됨",
                    "menu_file": "파일",
                    "menu_help": "도움말",
                    "menu_lang": "언어 (Language)",
                    "btn_add_folder": "폴더 추가",
                    "btn_add_drive": "드라이브 추가",
                    "btn_clear": "초기화",
                    "lbl_no_selection": "선택된 위치 없음",
                    "grp_search_loc": "1. 검색 위치",
                    "grp_search_opt": "2. 검색 옵션",
                    "lbl_ext": "확장자 (예: jpg, pdf):",
                    "ph_ext": "비워두면 모든 파일",
                    "lbl_min_size": "최소 파일 크기 (KB):",
                    "chk_same_name": "파일 이름도 동일해야 함",
                    "chk_byte_compare": "바이트 단위 정밀 비교 (100% 정확, 속도 느림)",
                    "chk_protect_system": "시스템 폴더 보호 (Windows/Program Files 등 제외)",
                    "btn_start_scan": "스캔 시작",
                    "col_path": "파일 경로 / 그룹",
                    "col_size": "크기",
                    "col_mtime": "수정 날짜",
                    "col_ext": "확장자",
                    "lbl_preview": "미리보기",
                    "msg_select_file": "파일을 선택하면 미리보기가 표시됩니다.",
                    "btn_smart_select": "자동 선택 (스마트)",
                    "tip_smart_select": "각 그룹에서 '수정 날짜가 가장 오래된' 파일을 원본으로 간주하고 남깁니다.",
                    "btn_export": "결과 내보내기 (CSV)",
                    "btn_delete_selected": "선택 항목 삭제 (Undo 가능)",
                    "msg_no_files_selected": "선택된 파일이 없습니다.",
                    "confirm_delete_title": "삭제 확인",
                    "confirm_delete_msg": "{}개의 파일을 삭제(임시 보관)하시겠습니까?\n'실행 취소'로 복구할 수 있습니다.",
                    "msg_delete_success": "{}개 파일 삭제됨. (Ctrl+Z로 취소 가능)",
                    "msg_undo_complete": "실행 취소 완료.",
                    "msg_redo_complete": "다시 실행 완료: {}개 재삭제됨.",
                    "msg_scan_complete": "완료: {}개의 중복 그룹 발견",
                    "err_no_folder": "검색할 폴더나 드라이브를 추가해주세요.",
                    "err_save": "저장 중 오류가 발생했습니다:\n{}",
                    "ctx_open": "열기",
                    "ctx_open_folder": "폴더 열기",
                    "ctx_copy_path": "경로 복사",
                    "file_open_dialog": "폴더 선택",
                    "status_collecting_files": "파일 목록 수집 중...",
                    "status_hashing": "해시 계산 중...",
                    "status_hashing_progress": "해시 계산 중 ({}/{})",
                    "status_analyzing": "정밀 분석 대상",
                    "status_undoing": "실행 취소 중...",
                    "status_redoing": "다시 실행 중...",
                    "status_byte_compare": "바이트 정밀 비교 중...",
                    "status_comparing": "중복 비교 중...",
                    "status_done": "완료",
                    "status_stopped": "중지됨",
                    "dlg_empty_title": "빈 폴더 정리기",
                    "lbl_search_target": "검색 대상: {}개 위치",
                    "btn_scan_empty": "빈 폴더 검색",
                    "btn_delete_all": "전체 삭제",
                    "status_searching": "검색 중...",
                    "status_search_done": "검색 완료: {}개 발견",
                    "confirm_empty_delete": "{}개의 빈 폴더를 삭제하시겠습니까?\n이 작업은 되돌릴 수 없습니다!",
                    "msg_empty_delete_result": "{}개 삭제 완료.\n{}개 실패.",
                    "msg_n_folders_added": "{}개 폴더가 추가되었습니다.",
                    "action_undo": "실행 취소 (Undo)",
                    "action_redo": "다시 실행 (Redo)",
                    "action_empty_finder": "빈 폴더 찾기",
                    "action_theme": "다크 모드",
                    "msg_title_notice": "알림",
                    "msg_add_folder_first": "먼저 검색할 위치를 추가해주세요.",
                    "msg_delete_files_title": "파일 삭제",
                    "msg_delete_files_confirm": "{}개의 파일을 삭제하시겠습니까? (휴지통 이동)",
                    "err_open_file": "파일을 열 수 없습니다.",
                    "term_duplicate_group": "중복 그룹",
                    "term_files": "파일",
                    "err_unexpected": "알 수 없는 오류가 발생했습니다:\n{}",
                    "lang_ko": "한국어",
                    "lang_en": "English"
                }
            }
        return cls._instance

    def set_language(self, lang_code):
        if lang_code in self.translations:
            self.current_lang = lang_code
        else:
            self.current_lang = "en" # Fallback

    def tr(self, key):
        return self.translations.get(self.current_lang, {}).get(key, key)

# Blender-style singleton access
strings = I18n()
